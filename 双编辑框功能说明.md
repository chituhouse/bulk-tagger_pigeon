# 双编辑框功能说明

## 概述
在 v0.8.6 版本中，我们优化了提示词编辑界面，现在支持对新旧提示词的双重编辑功能，让用户有更灵活的编辑和管理选项。

## 主要功能

### 1. 双编辑框设计
- **当前提示词编辑框**：现在可以编辑，用于修改已有的提示词
- **新生成的提示词编辑框**：可以编辑重新生成的提示词
- 两个编辑框都支持实时编辑，用户可以自由修改内容

### 2. 中英文自动分离
- 系统会自动检测提示词中的中英文内容
- 中文字符（Unicode范围 \u4e00-\u9fff）被识别为中文
- 英文部分单独保存到 TXT 文件，用于训练
- 中文部分保存在 manifest 中作为备用

### 3. 三种操作模式

#### 保存当前（蓝色按钮）
- 保存当前提示词编辑框中的内容
- 自动拆分中英文并创建 TXT 文件
- 适用于只想修改现有提示词的场景

#### 通过（绿色按钮）
- 优先使用新生成的提示词（如果有内容）
- 如果新生成的提示词为空，则使用当前提示词
- 自动拆分中英文并保存
- 清空新生成区域

#### 拒绝（红色按钮）
- 保存当前提示词的修改（如果有）
- 丢弃新生成的提示词
- 恢复界面到原始状态

### 4. 重新生成进度显示
- 单张重新生成时显示不确定进度条（跑马灯效果）
- 处理完成后自动隐藏进度条
- 提供实时状态反馈

## 使用场景

### 场景1：修改现有提示词
1. 选择图片，在"当前提示词"框中编辑
2. 点击"保存当前"按钮
3. 系统自动保存并创建 TXT 文件

### 场景2：对比新旧提示词
1. 点击"重新生成"获取新提示词
2. 在两个编辑框中分别编辑新旧提示词
3. 选择"通过"使用新提示词，或"拒绝"保留旧提示词

### 场景3：混合编辑
1. 重新生成后，同时编辑两个提示词
2. 可以从新提示词中复制部分内容到当前提示词
3. 根据需要选择最终保存的版本

## 技术细节

### 中英文分离算法
```python
def split_chinese_english(text: str):
    """将中英混合的提示词拆分为英文部分和中文部分"""
    # 按行分析，包含中文字符的行归为中文
    # 不包含中文字符的行归为英文
    # 返回 (英文, 中文) 元组
```

### 文件输出
- **TXT 文件**：只包含英文部分，用于 LoRA 训练
- **Manifest 文件**：同时保存英文和中文部分，用于管理

### 按钮状态管理
- 有新生成内容时：通过/拒绝按钮启用
- 无新生成内容时：只有保存当前按钮可用
- 处理过程中：相关按钮禁用，显示进度

## 优势

1. **灵活性**：支持多种编辑和保存方式
2. **效率**：可以快速对比和选择最佳提示词
3. **准确性**：自动分离中英文，确保训练数据纯净
4. **用户友好**：清晰的按钮标识和状态反馈

## 注意事项

1. 保存时会自动创建对应的 TXT 文件
2. 英文部分为空时，TXT 文件将为空
3. 建议在重新生成前先保存当前修改
4. 系统会自动备份中文内容到 manifest 文件 