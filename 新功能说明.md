# MiniMax反推打标工具 - 新功能说明

## 功能概述

本次更新为MiniMax反推打标工具新增了两个重要功能：

1. **通过/拒绝功能优化** - 新旧提示词对比功能
2. **批量重新生成功能** - 多选图片批量处理功能

---

## 功能一：通过/拒绝功能优化

### 功能描述
当用户对某张图片进行"重新生成"后，系统会显示新旧提示词的对比，用户可以选择通过（使用新提示词）或拒绝（保留原提示词）。

### 主要特性
- **上下对比显示**：当前提示词在上方（只读），新生成的提示词在下方（可编辑）
- **智能按钮状态**：只有在有新生成提示词时才启用通过/拒绝按钮
- **安全操作**：通过时会自动创建TXT文件，拒绝时会保留原有内容
- **视觉区分**：通过按钮为绿色，拒绝按钮为红色

### 使用流程
1. 选择一张图片
2. 点击"重新生成"按钮
3. 等待API生成新的提示词
4. 查看新旧提示词对比
5. 选择"通过"（使用新提示词）或"拒绝"（保留原提示词）

### 技术实现
- 使用`temp_new_prompt`临时属性保存新生成的提示词
- 通过时将临时提示词替换为正式提示词
- 拒绝时删除临时属性，保留原有内容
- 自动管理按钮状态和UI显示

---

## 功能二：批量重新生成功能

### 功能描述
用户可以通过复选框选择多张图片，然后一键批量重新生成这些图片的提示词。

### 主要特性
- **复选框支持**：每张图片前都有复选框，支持单独选择
- **全选功能**：提供全选/全不选复选框，支持批量选择
- **智能按钮状态**：只有选中图片时才启用批量重新生成按钮
- **进度显示**：显示批量处理的实时进度
- **并发处理**：使用独立线程进行批量处理，不阻塞UI

### 使用流程
1. 在图片列表中勾选要重新生成的图片
2. 点击"批量重新生成"按钮
3. 确认批量操作
4. 等待批量处理完成
5. 逐个查看和选择通过或拒绝新生成的提示词

### 技术实现
- 使用`BatchRegenerateThread`类进行后台批量处理
- 自定义列表项widget，包含复选框和状态标签
- 实时进度更新和状态反馈
- 完整的错误处理和线程管理

---

## 界面改进

### 图片列表区域
- 添加了批量操作控制区域
- 每个图片项都包含复选框
- 全选复选框支持三种状态：未选中、部分选中、全选中
- 批量重新生成按钮只在有选中项时启用

### 提示词显示区域
- 分为两个区域：当前提示词（只读）和新生成提示词（可编辑）
- 明确的标签区分："当前提示词"和"新生成的提示词"
- 通过/拒绝按钮有明显的颜色区分

### 按钮状态管理
- 智能的按钮启用/禁用逻辑
- 防止重复操作和并发冲突
- 清晰的状态反馈

---

## 使用建议

### 单张重新生成
1. 当对某张图片的提示词不满意时，选择该图片
2. 点击"重新生成"等待新提示词生成
3. 仔细对比新旧提示词的差异
4. 根据需要选择通过或拒绝

### 批量重新生成
1. 适用于需要批量改进提示词的场景
2. 建议先选择少量图片进行测试
3. 批量处理完成后，逐个审查结果
4. 可以结合全选功能快速选择所有图片

### 注意事项
- 重新生成会消耗API调用次数，请合理使用
- 批量操作时请确保网络连接稳定
- 建议在处理大量图片前先备份数据
- 通过的提示词会立即保存，拒绝的提示词会被丢弃

---

## 技术细节

### 线程管理
- `SingleImageProcessingThread`：单张图片重新生成
- `BatchRegenerateThread`：批量图片重新生成
- 完整的线程清理和资源管理

### 数据管理
- 使用临时属性存储新生成的提示词
- 智能的状态管理和数据同步
- 自动的文件创建和保存

### 错误处理
- 完整的API调用错误处理
- 网络异常和超时处理
- 用户友好的错误提示

### 性能优化
- 异步API调用，不阻塞UI
- 智能的按钮状态管理
- 高效的列表更新机制

---

## 版本信息
- 版本：v1.1.0
- 更新时间：2024年12月
- 新增功能：通过/拒绝对比功能、批量重新生成功能
- 兼容性：与现有功能完全兼容 